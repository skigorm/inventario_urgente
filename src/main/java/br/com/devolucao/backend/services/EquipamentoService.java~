package br.com.devolucao.backend.services;

import br.com.devolucao.backend.domain.InventarioUrgente;
import br.com.devolucao.backend.inv_domain.InvUsuario;
import br.com.devolucao.backend.inv_repositories.InvUsuarioRepository;
import br.com.devolucao.backend.repositories.InventarioUrgenteRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.Optional;

@Service
@RequiredArgsConstructor
public class EquipamentoService {

    private final InventarioUrgenteRepository inventarioUrgenteRepository;
    private final InvUsuarioRepository invUsuarioRepository;

    @Transactional
    public ResponseEntity<?> registrarInventario(InventarioUrgente request) {

        Optional<InvUsuario> usuarioOpt = invUsuarioRepository.findById(request.getUsuario().getId());
        if (usuarioOpt.isEmpty()) {
            return ResponseEntity.badRequest().body("Usuário não encontrado.");
        }

        InventarioUrgente novoInventario = new InventarioUrgente();
        novoInventario.setCodigoSap(request.getCodigoSap());
        novoInventario.setSerial(request.getSerial());
        novoInventario.setUsuario(usuarioOpt.get());

        inventarioUrgenteRepository.save(novoInventario);

        return ResponseEntity.ok("Inventário registrado com sucesso.");
    }
}

